{% extends "extends/main.html" %}
{% block title %}Quests{% endblock %}


{% block container %}
    <section class="header">
        <small>Your Quests</small>
    </section>
    <section class="bordered" x-data="{
    showModal(id) {
        document.getElementById(id).showModal()
    },
    closeModal(id) {
        document.getElementById(id).close()
    }
}">

        <div class="quests">
            {% for quest in q_quests %}
                <div class="quest-card">

                    <div class="flex flex-col gap-4">

                        <h2>{{ quest.title }}</h2>

                        <div class="inner-option-box">
                            <div>
                                {% if not quest.finished %}

                                    {% if not quest.building %}

                                        {% if quest.live %}
                                            <small>Live</small>
                                        {% else %}
                                            <small>Paused</small>
                                        {% endif %}

                                    {% else %}
                                        <small>Building</small>
                                    {% endif %}

                                {% else %}
                                    <small>Finished</small>
                                {% endif %}

                            </div>
                            <div>
                                <small>{{ quest.rel_genre.genre or "Genre Not Selected" }}</small>
                            </div>
                        </div>

                        <div class="inner-option-box">
                            <p><strong>Quest Code: </strong>{{ quest.quest_code }}</p>
                        </div>

                    </div>


                    <div class="flex flex-col gap-1">

                        <button class="btn"
                                @click="showModal('your_quest_{{ quest.quest_id }}')"
                                {% if not quest.summary %}disabled{% endif %}>
                            View Summary
                        </button>
                        <a href="{{ url_for('www.quest.edit', quest_id=quest.quest_id) }}"
                           class="btn">
                            Edit
                        </a>
                        <a href="{{ url_for('www.quest.master', quest_code=quest.quest_code) }}"
                           class="btn confirm">
                            Join as Quest Master
                        </a>

                    </div>

                </div>
                <dialog id="your_quest_{{ quest.quest_id }}">
                    <div>
                        <h2>{{ quest.title }}</h2>
                        <p>{{ quest.summary }}</p>
                        <button class="btn" @click="closeModal('your_quest_{{ quest.quest_id }}')">Close</button>
                    </div>
                </dialog>
            {% endfor %}

            <div class="quest-card-add">
                <a href="{{ url_for('www.quest.add') }}" class="btn confirm">
                    Add Quest
                </a>
            </div>
        </div>

    </section>

    <section class="header">
        <small>Joined Quests</small>
    </section>

    <section class="bordered">

        <div class="quests">

            <div class="quest-card-add">
                <form action="" class="flex flex-col gap-2">
                    <label for="join_quest" class="hidden">Join Quest</label>
                    <input type="text" name="join_quest" id="join_quest" placeholder="Quest Code">
                    <button type="submit" class="btn confirm">Request to Join</button>
                </form>
            </div>

        </div>

    </section>

{% endblock %}

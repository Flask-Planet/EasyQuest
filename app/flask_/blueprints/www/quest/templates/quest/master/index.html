{% extends "extends/main.html" %}
{% block title %}Quests - {{ q_quest.title }}{% endblock %}


{% block alpinejs_page_data %}
    <script>

        document.addEventListener('alpine:init', () => {
            Alpine.data('quest_master', () => ({

                ws: null,

                quest_id: {{ q_quest.quest_id }},
                quest_code: '{{ q_quest.quest_code }}',
                title: '{{ q_quest.title }}',
                genre: '{{ q_quest.rel_genre.genre }}',
                summary: '{{ q_quest.summary }}',

                building: {{ q_quest.building|string|lower }},
                live: {{ q_quest.live|string|lower }},
                finished: {{ q_quest.finished|string|lower }},

                wsConnect() {
                    this.socket = new WebSocket('{{ ws_uri }}')
                    this.wsEvents()
                },

                wsEvents() {
                    this.socket.onopen = (event) => {
                        console.log('WebSocket is connected')
                    }

                    this.socket.onmessage = (event) => {
                        console.log('Message from server: ', event.data)
                    }

                    this.socket.onclose = (event) => {
                        console.log('WebSocket is closed now.')
                    }
                },

                wsSend() {
                    this.socket.send(JSON.stringify({
                        'type': 'message',
                        'message': 'Hello, World!'
                    }))
                },

                init() {
                    this.wsConnect()
                }

            }))
        })

    </script>
{% endblock %}

{% block container %}

    <section x-data="quest_master">

        <button class="btn" @click="wsSend()">BUTTON</button>

    </section>

{% endblock %}
